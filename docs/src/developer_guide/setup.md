# Setup

## Linux

1. Set up local environment:

   Anki uses python 3.9, using other versions in the dev environment might lead to problems.
    ``` bash
    python3.9 -m pip install --upgrade pip
    python3.9 -m pip install virtualenv
    python3.9 -m virtualenv venv
    source venv/bin/activate
    python3.9 -m pip install -r requirements.txt
    pre-commit install
    ```
2. Set the project python interpreter to be `anki-morphs/venv/bin/python` to get your IDE to recognize the packages
   installed above.

3. Create a soft symbolic link from the cloned repo to the anki add-ons folder so anki starts using the cloned
   AnkiMorphs:
   ``` bash
   ln -s ~/path/to/cloned/repo/anki-morphs/ankimorphs  ~/.local/share/Anki2/addons21/ankimorphs
   ```
4. Using pre-commit:

   Pre-commit runs some commands (pylint, pytest, etc.) on the code before you commit to make sure the code is in good
   condition. Pre-commit is configured in `.pre-commit-config.yaml` and some of the commands have additional
   configurations in `pyproject.toml`.

   You can run it manually with the command:
   ``` bash
   pre-commit run --a
   ```

   **Optional:** if you use gitkraken you have to adjust the pre-commit script (`anki-morphs/.git/hooks/pre-commit`) to
   activate the virtual environment first:

   ```bash
   #!/usr/bin/env bash
   # File generated by pre-commit: https://pre-commit.com
   # ID: 138fd403232d2ddd5efb44317e38bf03
   
   # start templated
   ANKIMORPH_DIR=/home/mortii/git/anki-morphs/  # <--- ADD THIS LINE!
   INSTALL_PYTHON=/home/mortii/git/anki-morphs/venv/bin/python3
   ARGS=(hook-impl --config=.pre-commit-config.yaml --hook-type=pre-commit)
   # end templated
   
   HERE="$(cd "$(dirname "$0")" && pwd)"
   ARGS+=(--hook-dir "$HERE" -- "$@")
   
   if [ -x "$INSTALL_PYTHON" ]; then
       cd $ANKIMORPH_DIR && source venv/bin/activate  # <--- ADD THIS LINE!
       exec "$INSTALL_PYTHON" -mpre_commit "${ARGS[@]}"
   elif command -v pre-commit > /dev/null; then
       exec pre-commit "${ARGS[@]}"
   else
       echo '`pre-commit` not found.  Did you forget to activate your virtualenv?' 1>&2
       exit 1
   fi
   ```
